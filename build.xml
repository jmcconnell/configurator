<project name="configurator" default="jar">
  <property name="src.dir" location="src/main" />
  <property name="classes.dir" location="classes" />
  <property name="jar.name" value="configurator.jar" />

  <path id="project.classpath">
    <pathelement location="${src.dir}" />
    <pathelement location="${classes.dir}" />
    <fileset dir="lib">
      <include name="**/*.jar" />
    </fileset>
  </path>

  <path id="test.classpath">
    <path refid="project.classpath" />
    <pathelement location="src/test" />
  </path>

  <target name="clean" description="Remove generated files">
    <delete dir="${classes.dir}" />
    <delete file="${jar.name}" />
  </target>

  <target name="def-tasks">
    <taskdef name="clojure-compile"
      classname="com.ubermensch.ant.clojure.CompileTask"
      classpath="lib/ant-deps/clojure-ant-tasks.jar:lib/clojure-deps/clojure.jar:lib/clojure-deps/clojure-contrib.jar" />
    <taskdef name="clojure-test"
      classname="com.ubermensch.ant.clojure.TestTask"
      classpath="lib/ant-deps/clojure-ant-tasks.jar:lib/clojure-deps/clojure.jar:lib/clojure-deps/clojure-contrib.jar" />
  </target>

  <target name="compile" depends="def-tasks">
    <mkdir dir="${classes.dir}" />
    <clojure-compile>
      <classpath>
        <path refid="project.classpath" />
      </classpath>
      <namespace>com.ubermensch.configurator</namespace>
    </clojure-compile>
  </target>

  <target name="test" depends="compile">
    <clojure-test>
      <classpath>
        <path refid="test.classpath" />
      </classpath>
      <namespace>com.ubermensch.configurator</namespace>
    </clojure-test>
  </target>

  <target name="launch_ng">
    <java classname="com.martiansoftware.nailgun.NGServer"
          fork="true">
      <classpath>
        <path refid="project.classpath" />
      </classpath>
      <arg value="127.0.0.1" />
    </java>
  </target>

  <target name="jar" depends="test">
    <jar jarfile="${jar.name}" basedir="${classes.dir}">
      <fileset dir="${src.dir}">
        <include name="**/*.clj" />
      </fileset>
    </jar>
  </target>
</project>
